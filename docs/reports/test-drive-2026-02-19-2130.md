# Test Drive Report - 2026-02-19 (Program Actions)

## Scope
- Mode: branch (`bug/145-program-actions` vs `main`)
- Files changed: 17
- Routes affected: `/provider/dashboard/programs` (existing), `/programs/:id` (existing, via preview link)
- Test credentials: `shane.provider-1@gmail.com` / `password`

## Backend Checks

### Passed
- **Enrollment.list_program_enrollments/1**: Returns `[]` for programs with no enrollments (correct shape)
- **Enrollment.list_program_enrollments/1 edge case**: Returns `[]` for non-existent UUID (no crash)
- **ProgramCatalog.get_program_by_id/1**: Returns `{:ok, program}` with all fields needed by `program_to_form_params/1` (title, description, category, price, location, instructor, meeting_days, meeting_start_time, meeting_end_time, start_date, end_date, registration_period)
- **No N+1 patterns**: `list_by_program` uses single query; child name resolution uses batch `WHERE id IN (...)` query. Total: 2 queries max regardless of enrollment count
- **ACL boundary**: ChildInfoACL correctly maps Family context data to Enrollment-only fields (id, first_name, last_name)
- **Server logs**: Zero warnings or errors during all evaluations
- **Compilation**: Zero warnings with `--warnings-as-errors`
- **Tests**: All 264 enrollment context tests pass (27 pre-existing failures in unrelated Provider/ProgramCatalog repository tests)

### Issues Found
- None

## UI Checks

### Pages Tested

#### Provider Dashboard Programs (`/provider/dashboard/programs`)
- **Initial load**: PASS - Table renders with 2 programs, action buttons (Preview, View Roster, Edit) visible
- **Preview button (eye icon)**: PASS - Navigates to `/programs/:id`, shows program detail page
- **Edit button (pencil icon)**: PASS - Opens form with "Edit Program" heading, pre-populated with program data (title, category, price, description)
- **Edit submit**: PASS - Flash "Program updated successfully.", form closes, table refreshes
- **View Roster button (roster icon)**: PASS - Modal opens with "Roster: Soccer Fundamentals" title
- **Roster empty state**: PASS - Shows user-group icon + "No enrollments yet." message
- **Roster close (Escape key)**: PASS - Modal dismissed, table visible again
- **Mobile (375x667)**: PASS - Table horizontally scrollable, action buttons accessible via scroll, roster modal fits viewport
- **Browser console**: PASS - Zero JS errors related to changes (only pre-existing SVG path warnings)

### Issues Found
- **[severity: warning] FIXED**: Enrollment count regression after program edit
  - Steps to reproduce: Click Edit on a program -> Save without changes
  - Expected: Enrollment column shows `0/—` (same as before edit)
  - Actual (before fix): Shows `—/—` (enrolled count becomes nil)
  - Root cause: `update_existing_program` passed `enrolled: nil` instead of actual count
  - See Auto-Fixes section below

## Auto-Fixes Applied
- **dashboard_live.ex:671**: Fixed enrollment count regression after edit. `enrolled: nil` replaced with actual count from `Enrollment.count_active_enrollments_batch([program_id])`. This ensures the enrollment column displays correctly after saving an edited program.

## Recommendations
- None - all UI flows work correctly after the auto-fix. The 27 pre-existing test failures in Provider/ProgramCatalog repos should be investigated in a separate effort.
